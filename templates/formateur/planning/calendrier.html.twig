{% extends 'base.html.twig' %}

{% block title %}Mon emploi du temps - {{ nomMois }} {{ annee }}{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="{{ asset('css/admin.css') }}">
<style>
/* ========================================
   CALENDRIER PLANNING
   ======================================== */
.planning-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.planning-navigation {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.planning-navigation__title {
    min-width: 200px;
    text-align: center;
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--color-primary);
}

.planning-views {
    display: flex;
    gap: 0.5rem;
}

/* Grille calendrier */
.calendrier-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 1px;
    background: var(--border-color, #dee2e6);
    border: 1px solid var(--border-color, #dee2e6);
    border-radius: var(--border-radius-lg);
    overflow: hidden;
}

.calendrier-header {
    background: var(--color-primary);
    color: white;
    padding: 0.75rem 0.5rem;
    text-align: center;
    font-weight: 600;
    font-size: 0.875rem;
}

.calendrier-header--weekend {
    background: var(--color-primary-dark, #134759);
}

.calendrier-jour {
    background: white;
    min-height: 100px;
    padding: 0.5rem;
    position: relative;
    transition: background 0.2s;
}

.calendrier-jour:hover {
    background: var(--color-off-white, #f8f9fa);
}

.calendrier-jour--vide {
    background: var(--color-off-white, #f8f9fa);
}

.calendrier-jour--weekend {
    background: #fafafa;
}

.calendrier-jour--aujourdhui {
    background: #e3f2fd;
    box-shadow: inset 0 0 0 2px var(--color-primary);
}

.calendrier-jour--avec-seances {
    cursor: pointer;
}

.calendrier-jour__numero {
    font-weight: 600;
    font-size: 0.875rem;
    color: var(--color-text-secondary);
    margin-bottom: 0.5rem;
}

.calendrier-jour--aujourdhui .calendrier-jour__numero {
    color: var(--color-primary);
}

.calendrier-jour__badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 24px;
    height: 24px;
    padding: 0 6px;
    background: var(--color-primary);
    color: white;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
}

.calendrier-jour__preview {
    margin-top: 0.5rem;
    font-size: 0.75rem;
}

.calendrier-jour__seance-preview {
    display: block;
    padding: 2px 4px;
    margin-bottom: 2px;
    background: var(--color-off-white);
    border-left: 2px solid var(--color-primary);
    border-radius: 2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    color: var(--color-text-secondary);
}

.calendrier-jour__seance-preview:hover {
    background: #e3f2fd;
}

.calendrier-jour__more {
    font-size: 0.7rem;
    color: var(--color-text-muted);
    text-align: center;
    margin-top: 4px;
}

/* Stats cards */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.stat-card {
    background: white;
    padding: 1.25rem;
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow);
    text-align: center;
    border-left: 4px solid var(--color-primary);
}

.stat-card--success {
    border-left-color: var(--color-success, #28a745);
}

.stat-card--info {
    border-left-color: var(--color-info, #17a2b8);
}

.stat-card--warning {
    border-left-color: var(--color-warning, #ffc107);
}

.stat-card--secondary {
    border-left-color: var(--color-gray, #6c757d);
}

.stat-card__value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--color-primary);
    line-height: 1;
}

.stat-card__label {
    font-size: 0.875rem;
    color: var(--color-text-secondary);
    margin-top: 0.5rem;
}

/* L√©gende */
.calendrier-legende {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
    padding: 1rem;
    background: var(--color-off-white);
    border-radius: var(--border-radius);
    margin-top: 1rem;
}

.legende-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
}

.legende-item__color {
    width: 16px;
    height: 16px;
    border-radius: 4px;
}

/* Responsive */
@media (max-width: 768px) {
    .calendrier-grid {
        font-size: 0.8rem;
    }
    
    .calendrier-jour {
        min-height: 60px;
        padding: 0.25rem;
    }
    
    .calendrier-jour__preview {
        display: none;
    }
    
    .planning-header {
        flex-direction: column;
        text-align: center;
    }
}
</style>
{% endblock %}

{% block body %}
<section class="dashboard">
    <div class="container">
        {# En-t√™te #}
        <header class="dashboard__header">
            <h1 class="dashboard__title">üìÖ Mon emploi du temps</h1>
            <p class="dashboard__subtitle">
                Bienvenue {{ formateur.prenom }}, voici votre planning de cours
            </p>
        </header>

        {# Statistiques du mois #}
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-card__value">{{ stats.total }}</div>
                <div class="stat-card__label">S√©ances ce mois</div>
            </div>
            <div class="stat-card stat-card--info">
                <div class="stat-card__value">{{ stats.heures }}h</div>
                <div class="stat-card__label">Heures pr√©vues</div>
            </div>
            <div class="stat-card stat-card--success">
                <div class="stat-card__value">{{ stats.confirmees }}</div>
                <div class="stat-card__label">Confirm√©es</div>
            </div>
            <div class="stat-card stat-card--warning">
                <div class="stat-card__value">{{ stats.planifiees }}</div>
                <div class="stat-card__label">√Ä confirmer</div>
            </div>
        </div>

        {# Calendrier #}
        <div class="section-card">
            <div class="planning-header">
                {# Navigation mois #}
                <div class="planning-navigation">
                    <a href="{{ path('app_formateur_planning_calendrier', {annee: moisPrecedent.format('Y'), mois: moisPrecedent.format('n')}) }}" 
                       class="btn btn--outline btn--sm" title="Mois pr√©c√©dent">
                        ‚Üê {{ moisPrecedent.format('m/Y') }}
                    </a>
                    <span class="planning-navigation__title">
                        {{ nomMois }} {{ annee }}
                    </span>
                    <a href="{{ path('app_formateur_planning_calendrier', {annee: moisSuivant.format('Y'), mois: moisSuivant.format('n')}) }}" 
                       class="btn btn--outline btn--sm" title="Mois suivant">
                        {{ moisSuivant.format('m/Y') }} ‚Üí
                    </a>
                </div>

                {# Vues alternatives #}
                <div class="planning-views">
                    <a href="{{ path('app_formateur_planning_jour', {date: aujourdhui.format('Y-m-d')}) }}" 
                       class="btn btn--secondary btn--sm">
                        üìã Aujourd'hui
                    </a>
                    <a href="{{ path('app_formateur_planning_semaine', {date: aujourdhui.format('Y-m-d')}) }}" 
                       class="btn btn--secondary btn--sm">
                        üìÜ Semaine
                    </a>
                </div>
            </div>

            {# Grille calendrier #}
            <div class="calendrier-grid">
                {# En-t√™tes jours de la semaine #}
                <div class="calendrier-header">Lun</div>
                <div class="calendrier-header">Mar</div>
                <div class="calendrier-header">Mer</div>
                <div class="calendrier-header">Jeu</div>
                <div class="calendrier-header">Ven</div>
                <div class="calendrier-header calendrier-header--weekend">Sam</div>
                <div class="calendrier-header calendrier-header--weekend">Dim</div>

                {# Jours du mois #}
                {% for semaine in calendrier %}
                    {% for jour in semaine %}
                        {% if jour is null %}
                            <div class="calendrier-jour calendrier-jour--vide"></div>
                        {% else %}
                            <a href="{{ path('app_formateur_planning_jour', {date: jour.dateStr}) }}"
                               class="calendrier-jour 
                                      {{ jour.estWeekend ? 'calendrier-jour--weekend' : '' }}
                                      {{ jour.estAujourdhui ? 'calendrier-jour--aujourdhui' : '' }}
                                      {{ jour.nbSeances > 0 ? 'calendrier-jour--avec-seances' : '' }}"
                               style="text-decoration: none; color: inherit;">
                                <div class="calendrier-jour__numero">
                                    {{ jour.jour }}
                                    {% if jour.nbSeances > 0 %}
                                        <span class="calendrier-jour__badge">{{ jour.nbSeances }}</span>
                                    {% endif %}
                                </div>
                                
                                {# Aper√ßu des s√©ances (max 3) #}
                                {% if seancesParJour[jour.dateStr] is defined %}
                                    <div class="calendrier-jour__preview">
                                        {% for seance in seancesParJour[jour.dateStr]|slice(0, 3) %}
                                            <span class="calendrier-jour__seance-preview" 
                                                  style="border-left-color: {{ seance.statut.couleur }}">
                                                {{ seance.heureDebut|date('H:i') }}
                                                {% if seance.sessionMatiere and seance.sessionMatiere.matiere %}
                                                    {{ seance.sessionMatiere.matiere.code|default('') }}
                                                {% endif %}
                                            </span>
                                        {% endfor %}
                                        {% if seancesParJour[jour.dateStr]|length > 3 %}
                                            <div class="calendrier-jour__more">
                                                +{{ seancesParJour[jour.dateStr]|length - 3 }} autre(s)
                                            </div>
                                        {% endif %}
                                    </div>
                                {% endif %}
                            </a>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            </div>

            {# L√©gende #}
            <div class="calendrier-legende">
                <div class="legende-item">
                    <span class="legende-item__color" style="background: #17a2b8;"></span>
                    <span>Planifi√©e</span>
                </div>
                <div class="legende-item">
                    <span class="legende-item__color" style="background: #28a745;"></span>
                    <span>Confirm√©e</span>
                </div>
                <div class="legende-item">
                    <span class="legende-item__color" style="background: #ffc107;"></span>
                    <span>Report√©e</span>
                </div>
                <div class="legende-item">
                    <span class="legende-item__color" style="background: #6c757d;"></span>
                    <span>Termin√©e</span>
                </div>
                <div class="legende-item">
                    <span class="legende-item__color" style="background: #dc3545;"></span>
                    <span>Annul√©e</span>
                </div>
            </div>
        </div>

        {# Aide #}
        <div class="section-card" style="margin-top: 1.5rem;">
            <div class="section-card__header">
                <h2>üí° Utilisation</h2>
            </div>
            <div class="section-card__content">
                <p>
                    <strong>Cliquez sur un jour</strong> pour voir le d√©tail des s√©ances pr√©vues.
                    Depuis la vue jour, vous pouvez acc√©der √† chaque s√©ance pour :
                </p>
                <ul style="margin-top: 0.5rem; padding-left: 1.5rem;">
                    <li>Confirmer ou reporter une s√©ance</li>
                    <li>Consulter la liste des apprentis</li>
                    <li>Acc√©der √† la gestion des absences et des notes</li>
                </ul>
            </div>
        </div>
    </div>
</section>
{% endblock %}
