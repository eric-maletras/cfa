{% extends 'base.html.twig' %}

{% block title %}Modifier créneau - {{ session.code }}{% endblock %}


{% block body %}
<div class="page-header">
    <div class="page-header-content">
        <h1>
            {% include 'icons/_icons.html.twig' with {icon: 'edit'} %}
            Modifier le créneau
        </h1>
        <p class="subtitle">{{ creneau }}</p>
    </div>
</div>

{% for message in app.flashes('success') %}
    <div class="alert alert-success">{{ message }}</div>
{% endfor %}
{% for message in app.flashes('info') %}
    <div class="alert alert-info">{{ message }}</div>
{% endfor %}
{% for message in app.flashes('warning') %}
    <div class="alert alert-warning">{{ message }}</div>
{% endfor %}

{% if stats %}
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h3 class="mb-0">{{ stats.nbSeances }}</h3>
                <small class="text-muted">Séance(s) générée(s)</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h3 class="mb-0">{{ stats.nbSeancesNonModifiees }}</h3>
                <small class="text-muted">Non modifiée(s)</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h3 class="mb-0 {% if stats.estimation > 0 %}text-success{% endif %}">{{ stats.estimation }}</h3>
                <small class="text-muted">À générer</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h3 class="mb-0 {% if stats.nbConflits > 0 %}text-warning{% endif %}">{{ stats.nbConflits }}</h3>
                <small class="text-muted">Conflit(s)</small>
            </div>
        </div>
    </div>
</div>

{% if stats.messagesConflits|length > 0 %}
    <div class="alert alert-warning">
        <strong>Conflits détectés :</strong>
        <ul class="mb-0 mt-2">
            {% for msg in stats.messagesConflits %}
                <li>{{ msg }}</li>
            {% endfor %}
        </ul>
    </div>
{% endif %}

{% if stats.estimation > 0 or stats.nbSeances > 0 %}
<div class="card mb-4">
    <div class="card-body d-flex justify-content-between align-items-center">
        <div>
            {% if stats.estimation > 0 %}
                <strong>{{ stats.estimation }}</strong> séance(s) peuvent être générée(s).
            {% else %}
                Toutes les séances ont été générées.
            {% endif %}
        </div>
        <div>
            {% if stats.estimation > 0 %}
                <form action="{{ path('admin_session_creneaux_generate', {sessionId: session.id, id: creneau.id}) }}" method="post" class="d-inline">
                    <input type="hidden" name="_token" value="{{ csrf_token('generate' ~ creneau.id) }}">
                    <button type="submit" class="btn btn-success">
                        {% include 'icons/_icons.html.twig' with {icon: 'refresh'} %}
                        Générer les séances
                    </button>
                </form>
            {% endif %}
            {% if stats.nbSeances > 0 %}
                <form action="{{ path('admin_session_creneaux_generate', {sessionId: session.id, id: creneau.id}) }}" method="post" class="d-inline">
                    <input type="hidden" name="_token" value="{{ csrf_token('generate' ~ creneau.id) }}">
                    <input type="hidden" name="regenerer" value="1">
                    <button type="submit" class="btn btn-outline-warning"
                            onclick="return confirm('Régénérer supprimera les {{ stats.nbSeancesNonModifiees }} séance(s) non modifiée(s). Continuer ?');">
                        {% include 'icons/_icons.html.twig' with {icon: 'refresh'} %}
                        Régénérer
                    </button>
                </form>
            {% endif %}
        </div>
    </div>
</div>
{% endif %}
{% endif %}

{% include 'admin/session_creneaux/_form.html.twig' %}

<div class="card mt-5 border-danger">
    <div class="card-header bg-danger text-white">
        <strong>Zone de danger</strong>
    </div>
    <div class="card-body">
        <p>La suppression du créneau entraînera également la suppression de toutes les séances associées.</p>
        <form action="{{ path('admin_session_creneaux_delete', {sessionId: session.id, id: creneau.id}) }}" 
              method="post" 
              onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer ce créneau et ses {{ stats.nbSeances }} séance(s) ?');">
            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ creneau.id) }}">
            <button type="submit" class="btn btn-danger">
                {% include 'icons/_icons.html.twig' with {icon: 'trash'} %}
                Supprimer ce créneau
            </button>
        </form>
    </div>
</div>
{% endblock %}
