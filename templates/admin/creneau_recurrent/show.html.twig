{% extends 'base.html.twig' %}

{% block title %}D√©tails cr√©neau - Planning{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="{{ asset('css/admin.css') }}">
<style>
.details-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
}

@media (max-width: 992px) {
    .details-grid {
        grid-template-columns: 1fr;
    }
}

.section-card--full {
    grid-column: 1 / -1;
}

.details-list {
    margin: 0;
}

.detail-row {
    display: flex;
    padding: 0.75rem 0;
    border-bottom: 1px solid #eee;
}

.detail-row:last-child {
    border-bottom: none;
}

.detail-row dt {
    flex: 0 0 140px;
    font-weight: 500;
    color: #666;
}

.detail-row dd {
    flex: 1;
    margin: 0;
}

/* Badges */
.jour-badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 4px;
    font-weight: 600;
}
.jour-lundi { background: #e3f2fd; color: #1565c0; }
.jour-mardi { background: #f3e5f5; color: #7b1fa2; }
.jour-mercredi { background: #e8f5e9; color: #2e7d32; }
.jour-jeudi { background: #fff3e0; color: #ef6c00; }
.jour-vendredi { background: #fce4ec; color: #c2185b; }

.semaine-badge {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 3px;
    font-size: 0.9rem;
}
.semaine-A { background: #bbdefb; color: #1565c0; }
.semaine-B { background: #c8e6c9; color: #2e7d32; }
.semaine-all { background: #f5f5f5; color: #616161; }

.formateur-tag {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    background: #e8eaf6;
    color: #3949ab;
    border-radius: 4px;
    margin-right: 0.5rem;
    margin-bottom: 0.25rem;
}

.text-muted {
    color: #999;
    font-style: italic;
}

/* Actions bar */
.actions-bar {
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid #e0e0e0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.actions-right {
    display: flex;
    gap: 0.5rem;
}

.btn--success {
    background: #28a745;
    color: #fff;
    border: none;
}

.btn--success:hover {
    background: #218838;
}

/* Conflits */
.conflits-alert {
    background: #fff3cd;
    border: 1px solid #ffc107;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1.5rem;
}

.conflits-alert h3 {
    margin: 0 0 0.75rem 0;
    color: #856404;
    font-size: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.conflit-item {
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
    padding: 0.5rem 0;
    border-bottom: 1px solid rgba(0,0,0,0.1);
    font-size: 0.9rem;
    color: #856404;
}

.conflit-item:last-child {
    border-bottom: none;
    padding-bottom: 0;
}

.conflit-item::before {
    content: "‚ö†Ô∏è";
}

.conflit-item a {
    color: #856404;
    text-decoration: underline;
}
</style>
{% endblock %}

{% block body %}
<section class="dashboard">
    <div class="container">
        {# En-t√™te #}
        <header class="dashboard__header">
            <div class="header-actions">
                <a href="{{ path('admin_creneau_index', {session: creneau.session.id}) }}" class="btn btn--secondary btn--sm">
                    ‚Üê Retour aux cr√©neaux
                </a>
            </div>
            <h1 class="dashboard__title">üïê D√©tails du cr√©neau</h1>
            <p class="dashboard__subtitle">
                {{ creneau.session.code }} - {{ creneau.jourSemaine.libelle }}
            </p>
        </header>

        {# Alerte conflits #}
        {% if conflits is defined and (conflits.salle|length > 0 or conflits.formateurs|length > 0) %}
        <div class="conflits-alert">
            <h3>‚ö†Ô∏è Conflits d√©tect√©s</h3>
            {% for conflit in conflits.salle %}
                <div class="conflit-item">
                    {{ conflit.message }}
                    <a href="{{ path('admin_creneau_show', {id: conflit.creneau.id}) }}">Voir ‚Üí</a>
                </div>
            {% endfor %}
            {% for conflit in conflits.formateurs %}
                <div class="conflit-item">
                    {{ conflit.message }}
                    <a href="{{ path('admin_creneau_show', {id: conflit.creneau.id}) }}">Voir ‚Üí</a>
                </div>
            {% endfor %}
        </div>
        {% endif %}

        <div class="details-grid">
            {# Informations principales #}
            <div class="section-card">
                <div class="section-card__header">
                    <h2>Informations g√©n√©rales</h2>
                </div>
                <dl class="details-list">
                    <div class="detail-row">
                        <dt>Session</dt>
                        <dd>{{ creneau.session.code }} - {{ creneau.session.libelle }}</dd>
                    </div>
                    <div class="detail-row">
                        <dt>Statut</dt>
                        <dd>
                            {% if creneau.actif %}
                                <span class="status status--success">Actif</span>
                            {% else %}
                                <span class="status status--danger">Inactif</span>
                            {% endif %}
                        </dd>
                    </div>
                </dl>
            </div>

            {# Planification #}
            <div class="section-card">
                <div class="section-card__header">
                    <h2>Planification</h2>
                </div>
                <dl class="details-list">
                    <div class="detail-row">
                        <dt>Jour</dt>
                        <dd>
                            <span class="jour-badge jour-{{ creneau.jourSemaine.name|lower }}">
                                {{ creneau.jourSemaine.libelle }}
                            </span>
                        </dd>
                    </div>
                    <div class="detail-row">
                        <dt>Horaires</dt>
                        <dd>{{ creneau.heureDebut|date('H:i') }} - {{ creneau.heureFin|date('H:i') }}</dd>
                    </div>
                    <div class="detail-row">
                        <dt>Type de semaine</dt>
                        <dd>
                            {% if creneau.semaineType %}
                                <span class="semaine-badge semaine-{{ creneau.semaineType.value }}">
                                    Semaine {{ creneau.semaineType.value }}
                                </span>
                            {% else %}
                                <span class="semaine-badge semaine-all">Toutes les semaines</span>
                            {% endif %}
                        </dd>
                    </div>
                    <div class="detail-row">
                        <dt>P√©riode de validit√©</dt>
                        <dd>
                            Du {{ creneau.dateDebut|date('d/m/Y') }} au {{ creneau.dateFin|date('d/m/Y') }}
                        </dd>
                    </div>
                </dl>
            </div>

            {# Contenu p√©dagogique #}
            <div class="section-card">
                <div class="section-card__header">
                    <h2>Contenu p√©dagogique</h2>
                </div>
                <dl class="details-list">
                    <div class="detail-row">
                        <dt>Mati√®re</dt>
                        <dd>
                            {% if creneau.sessionMatiere and creneau.sessionMatiere.matiere %}
                                {{ creneau.sessionMatiere.matiere.code }} - {{ creneau.sessionMatiere.matiere.libelle }}
                            {% else %}
                                <span class="text-muted">Non d√©finie</span>
                            {% endif %}
                        </dd>
                    </div>
                    <div class="detail-row">
                        <dt>Formateur(s)</dt>
                        <dd>
                            {% for formateur in creneau.formateurs %}
                                <span class="formateur-tag">{{ formateur.nomComplet }}</span>
                            {% else %}
                                <span class="text-muted">Aucun formateur assign√©</span>
                            {% endfor %}
                        </dd>
                    </div>
                </dl>
            </div>

            {# Lieu #}
            <div class="section-card">
                <div class="section-card__header">
                    <h2>Lieu</h2>
                </div>
                <dl class="details-list">
                    <div class="detail-row">
                        <dt>Salle</dt>
                        <dd>
                            {% if creneau.salle %}
                                {{ creneau.salle.code }} - {{ creneau.salle.libelle }}
                                {% if creneau.salle.capacite %}
                                    ({{ creneau.salle.capacite }} places)
                                {% endif %}
                            {% else %}
                                <span class="text-muted">Non d√©finie</span>
                            {% endif %}
                        </dd>
                    </div>
                </dl>
            </div>

            {# Commentaire #}
            {% if creneau.commentaire %}
            <div class="section-card section-card--full">
                <div class="section-card__header">
                    <h2>Commentaire</h2>
                </div>
                <p>{{ creneau.commentaire|nl2br }}</p>
            </div>
            {% endif %}
        </div>

        {# Actions #}
        <div class="actions-bar">
            <a href="{{ path('admin_creneau_index', {session: creneau.session.id}) }}" class="btn btn--secondary">
                ‚Üê Retour √† la liste
            </a>
            <div class="actions-right">
                {% if creneau.actif %}
                <a href="{{ path('admin_creneau_generer', {id: creneau.id}) }}" class="btn btn--success">
                    üìÖ G√©n√©rer les s√©ances
                </a>
                {% endif %}
                <a href="{{ path('admin_creneau_edit', {id: creneau.id}) }}" class="btn btn--primary">
                    ‚úèÔ∏è Modifier
                </a>
                <form action="{{ path('admin_creneau_toggle', {id: creneau.id}) }}" method="post" style="display:inline;">
                    <input type="hidden" name="_token" value="{{ csrf_token('toggle' ~ creneau.id) }}">
                    <button type="submit" class="btn btn--outline">
                        {{ creneau.actif ? '‚è∏Ô∏è D√©sactiver' : '‚ñ∂Ô∏è Activer' }}
                    </button>
                </form>
                <form action="{{ path('admin_creneau_duplicate', {id: creneau.id}) }}" method="post" style="display:inline;">
                    <input type="hidden" name="_token" value="{{ csrf_token('duplicate' ~ creneau.id) }}">
                    <button type="submit" class="btn btn--outline">
                        üìã Dupliquer
                    </button>
                </form>
            </div>
        </div>
    </div>
</section>
{% endblock %}
