{% extends 'base.html.twig' %}

{% block title %}Planning & Ressources{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="{{ asset('css/admin.css') }}">
<style>
.help-content dl {
    margin: 1rem 0 0 0;
}

.help-content dt {
    font-weight: 600;
    margin-top: 1rem;
}

.help-content dt:first-of-type {
    margin-top: 0;
}

.help-content dd {
    margin: 0.25rem 0 0 0;
    color: var(--text-muted, #666);
}

.help-content dd em {
    color: #999;
    font-size: 0.875rem;
}

.prochains-fermes {
    list-style: none;
    padding: 0;
    margin: 0;
}

.prochain-ferme {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 0;
    border-bottom: 1px solid var(--border-color, #e0e0e0);
}

.prochain-ferme:last-child {
    border-bottom: none;
}

.prochain-ferme__icone {
    font-size: 1.25rem;
}

.prochain-ferme__date {
    font-weight: 600;
    min-width: 90px;
}

.prochain-ferme__libelle {
    flex: 1;
}
</style>
{% endblock %}

{% block body %}
<section class="dashboard">
    <div class="container">
        {# En-t√™te #}
        <header class="dashboard__header">
            <div class="header-actions">
                <a href="{{ path('app_dashboard') }}" class="btn btn--secondary btn--sm">
                    ‚Üê Retour au tableau de bord
                </a>
            </div>
            <h1 class="dashboard__title">üìÖ Planning & Ressources</h1>
            <p class="dashboard__subtitle">Gestion des salles, calendriers et planification</p>
        </header>

        {# Statistiques globales #}
        <div class="section-card">
            <div class="section-card__header">
                <h2>Vue d'ensemble</h2>
            </div>
            
            <div class="stats-row">
                <div class="stat-item">
                    <span class="stat-item__value">{{ stats.salles.actives }}</span>
                    <span class="stat-item__label">salles actives</span>
                </div>
                <div class="stat-item">
                    <span class="stat-item__value">{{ stats.salles.parType['labo_info'] ?? 0 }}</span>
                    <span class="stat-item__label">labos informatique</span>
                </div>
                <div class="stat-item">
                    <span class="stat-item__value">{{ stats.calendrier.anneeActive }}</span>
                    <span class="stat-item__label">ann√©e active</span>
                </div>
                <div class="stat-item">
                    <span class="stat-item__value">{{ stats.calendrier.nbJoursFermes }}</span>
                    <span class="stat-item__label">jours ferm√©s</span>
                </div>
            </div>
        </div>

        {# Prochains jours ferm√©s si calendrier actif #}
        {% if calendrierActif and stats.calendrier.prochainsFermes is not empty %}
        <div class="section-card">
            <div class="section-card__header">
                <h2>üìç Prochains jours ferm√©s</h2>
                <a href="{{ path('admin_calendrier_show', {id: calendrierActif.id}) }}" class="btn btn--outline btn--sm">
                    Voir le calendrier ‚Üí
                </a>
            </div>
            <ul class="prochains-fermes">
                {% for jour in stats.calendrier.prochainsFermes %}
                <li class="prochain-ferme">
                    <span class="prochain-ferme__icone">{{ jour.type.icone }}</span>
                    <span class="prochain-ferme__date">{{ jour.date|date('d/m/Y') }}</span>
                    <span class="prochain-ferme__libelle">{{ jour.libelle }}</span>
                    <span class="badge badge--{{ jour.type.badgeClass }}">{{ jour.type.libelle }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        {# Cartes des sous-modules #}
        <div class="section-card">
            <div class="section-card__header">
                <h2>Modules</h2>
            </div>
            
            <div class="dashboard__modules">
                {% for module in sousModules %}
                    {% if module.route and not module.disabled|default(false) %}
                        <a href="{{ path(module.route) }}" class="module-card module-card--{{ module.couleur }}">
                            <div class="module-card__icon">
                                {{ include('icons/_icons.html.twig', {icon: module.icone}) }}
                            </div>
                            <h3 class="module-card__title">{{ module.nom }}</h3>
                            <p class="module-card__description">{{ module.description }}</p>
                            <span class="module-card__stats">{{ module.stats }}</span>
                        </a>
                    {% else %}
                        <div class="module-card module-card--disabled">
                            <div class="module-card__icon">
                                {{ include('icons/_icons.html.twig', {icon: module.icone}) }}
                            </div>
                            <h3 class="module-card__title">{{ module.nom }}</h3>
                            <p class="module-card__description">{{ module.description }}</p>
                            <span class="module-card__stats">üîí {{ module.stats }}</span>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>

        {# Aide contextuelle #}
        <div class="section-card">
            <div class="section-card__header">
                <h2>üí° √Ä propos de ce module</h2>
            </div>
            <div class="help-content">
                <p>
                    Le module <strong>Planning & Ressources</strong> vous permet de g√©rer l'ensemble des ressources 
                    li√©es √† la planification des cours : salles, cr√©neaux horaires, calendriers et r√©servations.
                </p>
                <dl>
                    <dt>Gestion des salles</dt>
                    <dd>Cr√©ez et configurez les salles de cours, laboratoires et espaces virtuels.</dd>
                    
                    <dt>Calendrier annuel</dt>
                    <dd>G√©rez les ann√©es scolaires et les jours ferm√©s (f√©ri√©s, vacances, ponts).</dd>
                    
                    <dt>Cr√©neaux horaires</dt>
                    <dd><em>(Prochainement)</em> Configurez les plages horaires de formation.</dd>
                    
                    <dt>R√©servations</dt>
                    <dd><em>(Prochainement)</em> G√©rez la r√©servation des salles par les formateurs.</dd>
                </dl>
            </div>
        </div>
    </div>
</section>
{% endblock %}
